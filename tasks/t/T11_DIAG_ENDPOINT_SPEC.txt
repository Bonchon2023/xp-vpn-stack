# tasks/T/T11_DIAG_ENDPOINT_SPEC.txt
Version: v0.1
Datum: 2026-01-06
Priority: SHOULD
Owner-Intent: Support ohne SSH: /diag liefert klare Zustände (DNS/VPN/Apply/Spool).

## 1) Zweck
/diag Spezifikation:
- welche Checks
- welche Daten je Role (User vs Admin)
- output format (text/json/html)

## 2) Scope / Nicht-Ziele
- Keine UI/Design Umsetzung.
- Keine expose von secrets.

## 3) Inputs (Truth Sources)
- blocks/B270_DIAG_ENDPOINT.txt
- blocks/B180_SYSTEMD_RESTART_HEALTHCHECKS.txt
- blocks/B165_ACCOUNTING_COLLECTOR_SESSION_MAPPING.txt
- T06 (scopes), T08 (authz)

## 4) Outputs (Deliverables)
- `docs/diag_spec.md`
  - checks list (ipsec status, ppp sessions, dns enforcement counters, spool size, last apply time)
  - role-based redaction rules
- `tests/diag_scope_tests.md`

## 5) Dependencies
- T06 (network scopes)
- T08 (authz model)

## 6) Risiken / Randfälle
- leaking of user data across tenants
- /diag becomes an attack surface without auth/ratelimit

## 7) Tests / Acceptance Criteria (messbar)
MUST:
- User sees only own connection-related data.
- Admin sees global system status.
- No sensitive secrets in output.

## 8) Offene Punkte / Entscheidungen
- output format decision (json vs html).
- is /diag publicly reachable within VPN user net or admin-only?

## 9) Changelog
- v0.1 (2026-01-06): Task-Datei angelegt.