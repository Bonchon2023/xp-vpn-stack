# tasks/T/T05_ACCOUNTING_SPOOL_POLICY.txt
Version: v0.1
Datum: 2026-01-06
Priority: MUST
Owner-Intent: Spool darf nicht unbounded wachsen; Replay muss dedupe-safe sein.

## 1) Zweck
Accounting Spool Policy definieren:
- Quota/Max Size
- Rotation/Retention
- Overflow behavior
- Replay Safety (Dedup/Idempotenz)
- Monitoring/Alarm

## 2) Scope / Nicht-Ziele
- Keine Panel-Charts (T15/T08).
- Keine komplette Collector-Implementation (nur Policy).

## 3) Inputs (Truth Sources)
- blocks/B050_SQL_AAA_RADIUS.txt (Spool-Idee, delayed enforcement)
- blocks/B165_ACCOUNTING_COLLECTOR_SESSION_MAPPING.txt (Collector/Mapping)
- D002_RESOURCE_BUDGETS (Disk/Retention hängt davon ab)

## 4) Outputs (Deliverables)
- `docs/accounting_spool_policy.md`
  - Directory layout
  - file format (event log / json lines / csv — je Konzept)
  - replay ordering + dedupe key
  - limits (max size, max age)
  - overflow behavior (drop oldest / stop writing / degrade)
- `tests/spool_replay_drill.md`

## 5) Dependencies
- Empfohlen: T02 (radacct semantics) oder klare Accounting-Event Definition.
- D002 Resource Budgets (sonst sind Limits willkürlich).

## 6) Risiken / Randfälle
- DB down lange Zeit -> spool growth.
- Disk full -> Systemausfall.
- Replay duplicates -> falsche Usage/Quota Entscheidungen.
- Out-of-order events -> falsche Session mapping.

## 7) Tests / Acceptance Criteria (messbar)
MUST:
- DB down simulation: spool wächst kontrolliert, keine Disk-Full Situation.
- DB up: replay vollständig, totals stimmen, keine duplicates.
- Disk-pressure: definierte Degradation + Alarm tritt ein.

## 8) Offene Punkte / Entscheidungen
- Overflow behavior: drop oldest vs stop vs degrade.
- Dedup key: (session-id + timestamp + type) oder (radacct unique fields).
- Retention: days/weeks (abhängig von D002).

## 9) Changelog
- v0.1 (2026-01-06): Task-Datei angelegt.