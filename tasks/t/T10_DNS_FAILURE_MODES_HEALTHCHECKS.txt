# tasks/T/T10_DNS_FAILURE_MODES_HEALTHCHECKS.txt
Version: v0.1
Datum: 2026-01-06
Priority: MUST
Owner-Intent: DNS ist MUST; Ausfälle müssen sichtbar, recoverable, und testbar sein.

## 1) Zweck
DNS failure modes + healthchecks definieren:
- AdGuard down
- Unbound down
- DNAT53 mismatch
- logging/counters for enforcement visibility
- recovery behavior (systemd restarts)

## 2) Scope / Nicht-Ziele
- Kein DoH/DoT blocking (T04).
- Keine panel charts (T15).

## 3) Inputs (Truth Sources)
- blocks/B200_DNS_UNBOUND_ADGUARD.txt
- blocks/B210_DNS_ENFORCEMENT_DNAT53.txt
- blocks/B180_SYSTEMD_RESTART_HEALTHCHECKS.txt
- T06 (firewall scopes for DNS service-ip)

## 4) Outputs (Deliverables)
- `docs/dns_failure_modes.md`
  - expected client symptoms
  - detection signals (/diag, logs, counters)
  - recovery steps (auto restart, fallback)
- `tests/dns_failure_drill.md`

## 5) Dependencies
- T06 (DNS reachability scopes)
- Optional: T11 (/diag spec) if you want unified display.

## 6) Risiken / Randfälle
- Fail-closed vs fail-open: wenn DNS down, full-tunnel user hat „kein internet“.
- AdGuard log retention vs privacy/performance.

## 7) Tests / Acceptance Criteria (messbar)
MUST:
- Stop AdGuard -> failure detected -> auto-restart restores service.
- Stop Unbound -> failure detected -> restore.
- DNAT53 counters increase during DNS queries (enforcement visible).
- User cannot use external DNS via 53 (DNAT enforced) when system healthy.

## 8) Offene Punkte / Entscheidungen
- Fail strategy: fail-closed vs degraded fallback?
- What is minimal /diag output (falls T11 used)?

## 9) Changelog
- v0.1 (2026-01-06): Task-Datei angelegt.