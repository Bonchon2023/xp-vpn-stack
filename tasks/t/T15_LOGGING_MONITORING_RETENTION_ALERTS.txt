# tasks/T/T15_LOGGING_MONITORING_RETENTION_ALERTS.txt
Version: v0.1
Datum: 2026-01-06
Priority: MUST
Owner-Intent: Betriebssicherheit + heavy user detection ohne Disk-Full/Noise.

## 1) Zweck
Logging/Monitoring/Retention/Alerts:
- Welche Logs (VPN, RADIUS, DNS, nft counters, systemd health)
- Retention/Rotation
- Alarm conditions
- minimal metrics for panel reports (monthly usage, heavy user)

## 2) Scope / Nicht-Ziele
- Kein vollständiges observability stack (Prometheus/Grafana) unless explicitly chosen.
- Keine willkürlichen Budgets als Fakt (D002 muss entscheiden).

## 3) Inputs (Truth Sources)
- blocks/B180_SYSTEMD_RESTART_HEALTHCHECKS.txt
- blocks/B200_DNS_UNBOUND_ADGUARD.txt (DNS logs)
- blocks/B165_ACCOUNTING_COLLECTOR_SESSION_MAPPING.txt (usage)
- D002_RESOURCE_BUDGETS
- T05 (spool policy), T06 (firewall counters), T10 (dns failure modes)

## 4) Outputs (Deliverables)
- `docs/logging_retention_alerts.md`
  - log sources list
  - rotation rules (size/time)
  - retention duration per log type
  - alert rules (service down, spool overflow, dns failure, apply stuck)
- `tests/logging_rotation_alert_drill.md`

## 5) Dependencies
- D002 budgets (RAM/Disk)
- T05 spool policy
- T06 nft scopes/counters (for enforcement visibility)

## 6) Risiken / Randfälle
- Disk full due to logs/spool.
- Alert fatigue (too noisy) vs silent failure (too quiet).
- Privacy: DNS logs retention must be deliberate.

## 7) Tests / Acceptance Criteria (messbar)
MUST:
- Log rotation works (disk does not grow unbounded).
- Simulated service down triggers alert (as defined).
- Spool high-watermark triggers alert (as defined).
- Enforcement visibility exists (nft counters/log entries show DNAT53 behavior).

## 8) Offene Punkte / Entscheidungen
- D002: budgets finalize (disk retention limits depend on it).
- How to deliver alerts (mail? panel? syslog?) — must be explicitly chosen.

## 9) Changelog
- v0.1 (2026-01-06): Task-Datei angelegt.